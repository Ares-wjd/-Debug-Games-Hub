<!-- ai-word-game.html: 제한 시간 막대 UI 추가 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>디버그 동아리 | AI 단어 설명 게임</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #fff; transition: background-color 0.3s; }
    .container { background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px); width: 90%; max-width: 600px; padding: 30px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); text-align: center; }
    input, button { padding: 12px; margin: 10px 0; font-size: 1em; border-radius: 8px; border: none; }
    input { width: 80%; }
    button { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: #fff; cursor: pointer; }
    button:hover { transform: scale(1.05); }
    #result { font-size: 1.2em; margin-top: 10px; font-weight: bold; }
    #finalButtons { margin-top: 20px; }
    #descriptionText { margin: 15px 0; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 12px; display: none; }
    #timeBarContainer { width: 100%; height: 15px; background: #555; border-radius: 8px; margin: 10px 0; overflow: hidden; }
    #timeBar { width: 100%; height: 100%; background: #4caf50; transition: width 1s linear, background-color 0.5s; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🤖 AI 단어 설명 게임</h1>
    <div id="gameExplanation">
      <p>AI가 하나씩 설명을 추가하며 정답을 맞히게 됩니다.<br>게임을 시작하거나 게임 설명을 보려면 버튼을 눌러주세요.</p>
      <button onclick="startGame()">게임 시작</button>
      <button onclick="showDescription()">게임 설명 보기</button>
      <button onclick="goBack()">메인으로 돌아가기</button>
      <div id="descriptionText">
        <strong>게임 설명:</strong><br>
        - 제한 시간: 180초<br>
        - AI가 문제당 최대 3개의 힌트를 순차적으로 제공합니다.<br>
        - 한 문제당 3회까지 정답을 시도할 수 있으며, 시도 횟수에 따라 점수가 다릅니다.<br>
        (첫 시도: 25점, 두 번째 시도: 15점, 세 번째 시도: 5점)<br>
        - 3회 모두 틀리면 정답이 공개되고 다음 문제로 넘어갑니다.<br>
        - 시간이 종료되면 즉시 게임이 중단되고 최종 점수가 공개됩니다.
      </div>
    </div>
    <div id="gameArea" style="display:none;">
      <div>남은 시간: <span id="timer">180</span>초</div>
      <div id="timeBarContainer"><div id="timeBar"></div></div>
      <div id="hint">힌트가 여기에 표시됩니다</div>
      <input type="text" id="guessInput" placeholder="정답을 입력하세요" onkeydown="if(event.key==='Enter') checkAnswer()">
      <button onclick="checkAnswer()">제출</button>
      <div id="scoreBoard">점수: 0점</div>
      <div id="result"></div>
      <div id="attempts">남은 시도: 3회</div>
      <div id="finalButtons" style="display:none;">
        <button onclick="goBack()">메인으로 돌아가기</button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwk8QF3jJMzk30QeJR_kFTq6gQXGmoiG4",
      authDomain: "debug-games-hub.firebaseapp.com",
      projectId: "debug-games-hub",
      storageBucket: "debug-games-hub.firebasestorage.app",
      messagingSenderId: "391096300170",
      appId: "1:391096300170:web:156898c1574c15fca9f373"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const problems = [
      { answer: "의자", hints: ["앉을 수 있음", "네 다리", "책상 옆에 있음"] },
      { answer: "토끼", hints: ["귀가 긺", "풀을 먹음", "깡총깡총"] }
    ];

    let currentIndex = 0, score = 0, hintStep = 0, attempts = 3, timeLeft = 180, timerInterval;
    const hintDiv = document.getElementById('hint');
    const resultDiv = document.getElementById('result');
    const scoreBoard = document.getElementById('scoreBoard');
    const guessInput = document.getElementById('guessInput');
    const attemptsDiv = document.getElementById('attempts');
    const gameExplanation = document.getElementById('gameExplanation');
    const gameArea = document.getElementById('gameArea');
    const finalButtons = document.getElementById('finalButtons');
    const descriptionText = document.getElementById('descriptionText');
    const timerDisplay = document.getElementById('timer');
    const timeBar = document.getElementById('timeBar');
    const body = document.body;

    function startGame() {
      gameExplanation.style.display = 'none';
      gameArea.style.display = 'block';
      finalButtons.style.display = 'none';
      score = 0;
      currentIndex = 0;
      timeLeft = 180;
      updateTimeBar();
      timerDisplay.textContent = timeLeft;
      timerInterval = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft;
        updateTimeBar();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          endGame();
        }
      }, 1000);
      loadProblem();
    }

    function updateTimeBar() {
      const percent = (timeLeft / 180) * 100;
      timeBar.style.width = percent + '%';
      if (percent > 60) {
        timeBar.style.backgroundColor = '#4caf50'; // 초록
      } else if (percent > 30) {
        timeBar.style.backgroundColor = '#ff9800'; // 주황
      } else {
        timeBar.style.backgroundColor = '#f44336'; // 빨강
      }
    }

    function showDescription() {
      descriptionText.style.display = descriptionText.style.display === 'none' ? 'block' : 'none';
    }

    function loadProblem() {
      if (currentIndex >= problems.length) {
        endGame();
        return;
      }
      hintStep = 0;
      attempts = 3;
      attemptsDiv.textContent = `남은 시도: ${attempts}회`;
      showNextHint();
      guessInput.value = '';
      resultDiv.textContent = '';
    }

    function showNextHint() {
      const currentHints = problems[currentIndex].hints;
      if (hintStep < currentHints.length) {
        hintDiv.textContent = currentHints.slice(0, hintStep + 1).join(', ');
        hintStep++;
      }
    }

    function checkAnswer() {
      const input = guessInput.value.trim();
      if (!input) return;
      if (input === problems[currentIndex].answer) {
        let points = attempts === 3 ? 25 : attempts === 2 ? 15 : 5;
        score += points;
        resultDiv.innerHTML = `<span style='color: #4caf50;'>정답! +${points}점</span>`;
        scoreBoard.textContent = `점수: ${score}점`;
        flashEffect('#4caf50');
        currentIndex++;
        setTimeout(loadProblem, 1000);
      } else {
        attempts--;
        if (attempts > 0) {
          resultDiv.innerHTML = `<span style='color: #f44336;'>오답! 다음 힌트 추가 (남은 시도 ${attempts}회)</span>`;
          flashEffect('#f44336');
          attemptsDiv.textContent = `남은 시도: ${attempts}회`;
          showNextHint();
        } else {
          resultDiv.innerHTML = `<span style='color: #f44336;'>실패! 정답은 "${problems[currentIndex].answer}"였습니다.</span>`;
          flashEffect('#f44336');
          currentIndex++;
          setTimeout(loadProblem, 2000);
        }
      }
      guessInput.value = '';
    }

    function flashEffect(color) {
      const original = body.style.background;
      body.style.background = color;
      setTimeout(() => { body.style.background = ''; }, 300);
    }

    function endGame() {
      clearInterval(timerInterval);
      saveScore();
      resultDiv.innerHTML = `<span style='color: gold;'>게임 종료! 최종 점수: ${score}점</span>`;
      flashEffect('#ffd700');
      finalButtons.style.display = 'block';
    }

    function saveScore() {
      const user = JSON.parse(localStorage.getItem('currentUser'));
      if (!user) return;
      const newEntry = {
        id: user.id,
        name: user.name,
        game: 'AI 단어 설명 게임',
        score: score,
        time: new Date().toISOString()
      };
      const newKey = db.ref().child('rankings').push().key;
      const updates = {};
      updates['/rankings/' + newKey] = newEntry;
      db.ref().update(updates);
      alert(`게임 종료! 최종 점수: ${score}점`);
    }

    function goBack() {
      window.location.href = '/-Debug-Games-Hub/index.html';
    }
  </script>
</body>
</html>
