<!-- memory-card-game.html: Firebase 연동 버전 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>디버그 동아리 | 기억력 카드 게임</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #fff; }
    .container { background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px); width: 90%; max-width: 600px; padding: 30px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); text-align: center; }
    button { padding: 12px; margin: 10px; font-size: 1em; border-radius: 8px; border: none; background: linear-gradient(135deg, #ff416c, #ff4b2b); color: #fff; cursor: pointer; }
    button:hover { transform: scale(1.05); }
    .card { display: inline-block; width: 50px; height: 50px; margin: 5px; background: #fff; color: #333; border-radius: 8px; font-size: 1.2em; line-height: 50px; cursor: pointer; }
    .hidden { background: #999; color: transparent; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧠 기억력 카드 게임</h1>
    <div id="gameBoard"></div>
    <div id="scoreBoard">점수: 0</div>
    <button onclick="startGame()">게임 시작</button>
    <button onclick="goBack()">메인으로 돌아가기</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwk8QF3jJMzk30QeJR_kFTq6gQXGmoiG4",
      authDomain: "debug-games-hub.firebaseapp.com",
      projectId: "debug-games-hub",
      storageBucket: "debug-games-hub.firebasestorage.app",
      messagingSenderId: "391096300170",
      appId: "1:391096300170:web:156898c1574c15fca9f373"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let score = 0, firstCard = null, secondCard = null, lock = false;
    const board = document.getElementById('gameBoard');
    const scoreBoard = document.getElementById('scoreBoard');

    function startGame() {
      score = 0;
      scoreBoard.textContent = `점수: ${score}`;
      board.innerHTML = '';
      const items = [...Array(8).keys(), ...Array(8).keys()];
      items.sort(() => Math.random() - 0.5);
      items.forEach(num => {
        const card = document.createElement('div');
        card.className = 'card hidden';
        card.dataset.num = num;
        card.textContent = num;
        card.onclick = () => flipCard(card);
        board.appendChild(card);
      });
    }

    function flipCard(card) {
      if (lock || !card.classList.contains('hidden')) return;
      card.classList.remove('hidden');
      if (!firstCard) {
        firstCard = card;
      } else {
        secondCard = card;
        checkMatch();
      }
    }

    function checkMatch() {
      lock = true;
      if (firstCard.dataset.num === secondCard.dataset.num) {
        score += 10;
        scoreBoard.textContent = `점수: ${score}`;
        resetTurn();
      } else {
        setTimeout(() => {
          firstCard.classList.add('hidden');
          secondCard.classList.add('hidden');
          resetTurn();
        }, 1000);
      }
    }

    function resetTurn() {
      [firstCard, secondCard] = [null, null];
      lock = false;
      if ([...board.children].every(c => !c.classList.contains('hidden'))) saveScore();
    }

    function saveScore() {
      const user = JSON.parse(localStorage.getItem('currentUser'));
      if (!user) return;
      const newEntry = {
        id: user.id,
        name: user.name,
        game: '기억력 카드 게임',
        score: score,
        time: new Date().toISOString()
      };
      const newKey = db.ref().child('rankings').push().key;
      const updates = {};
      updates['/rankings/' + newKey] = newEntry;
      db.ref().update(updates);
      alert(`게임 종료! 최종 점수: ${score}`);
    }

    function goBack() {
      window.location.href = '/-Debug-Games-Hub/index.html';
    }
  </script>
</body>
</html>
