<!-- typing-speed-test.html: íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„ (ì—°ì† ë¬¸ì¥ ë°©ì§€, ì…ë ¥ ì‹œ íƒ€ì´ë¨¸ ì‹œì‘, íƒ€ìˆ˜ ë° ì •í™•ë„ í‘œì‹œ, ë³´ë„ˆìŠ¤ ì ìˆ˜ ì¶”ê°€) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„</title>
  <style>
    body { font-family: sans-serif; background: linear-gradient(135deg, #373b44, #4286f4); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .container { background: rgba(0,0,0,0.6); padding: 30px; border-radius: 16px; width: 90%; max-width: 700px; text-align: center; }
    h1 { margin-bottom: 20px; }
    input, button { padding: 10px; margin: 10px 0; border: none; border-radius: 8px; width: 100%; font-size: 1em; }
    input { color: #333; }
    button { background: #4caf50; color: #fff; cursor: pointer; }
    button:hover { background: #43a047; }
    #result, #cpm { font-size: 1.2em; margin-top: 10px; }
    #highlightedSentence span.correct { color: #4caf50; }
    #highlightedSentence span.wrong { color: #f44336; }
    #highlightedSentence span.pending { color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <div id="startArea">
      <h1>âŒ¨ï¸ íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„</h1>
      <p>ê²Œì„ ì„¤ëª…: ì£¼ì–´ì§„ ë¬¸ì¥ì„ ìµœëŒ€í•œ ë¹¨ë¦¬ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”. 60ì´ˆ ì œí•œ ì‹œê°„ ì•ˆì— ìµœëŒ€ ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”!</p>
      <button onclick="prepareGame()">ê²Œì„ ì‹œì‘</button>
      <button onclick="goToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="gameArea" style="display:none;">
      <p id="highlightedSentence"></p>
      <input type="text" id="inputArea" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”" oninput="handleInput()" onkeydown="if(event.key==='Enter') checkInput()">
      <button onclick="checkInput()">ì œì¶œ</button>
      <p id="score">ì ìˆ˜: 0</p>
      <p id="cpm">í˜„ì¬ CPM: 0</p>
      <p id="timer">ë‚¨ì€ ì‹œê°„: 60ì´ˆ</p>
      <p id="result"></p>
    </div>

    <div id="endArea" style="display:none;">
      <h2>ğŸ‰ ê²Œì„ ì¢…ë£Œ</h2>
      <p id="finalScore"></p>
      <p id="finalStats"></p>
      <button onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
      <button onclick="goToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </div>

  <script>
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const sentences = [
  "ì‚¬ê³¼ê°€ ë¹¨ê°›ê²Œ ìµì–´ ê°„ë‹¤.",
  "ì˜¤ëŠ˜ë„ í•™êµì— ì§€ê°í•˜ì§€ ì•Šì•˜ë‹¤.",
  "ì•„ì¹¨ í–‡ì‚´ì´ ìƒì¾Œí•˜ê²Œ ë¹„ì¹œë‹¤.",
  "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µì›ì—ì„œ ì‚°ì±…í–ˆë‹¤.",
  "ìš°ì²´êµ­ì—ì„œ í¸ì§€ë¥¼ ë¶€ì³¤ë‹¤.",
  "ì—„ë§ˆëŠ” ë§›ìˆëŠ” ë°¥ì„ ì§€ì–´ ì£¼ì…¨ë‹¤.",
  "ì±…ìƒ ìœ„ì— ì—°í•„ì´ ê°€ì§€ëŸ°íˆ ë†“ì˜€ë‹¤.",
  "ì•„ì´ëŠ” ì›ƒìœ¼ë©° ì¥ë‚œê°ì„ ì •ë¦¬í–ˆë‹¤.",
  "ë°”ëŒì´ ì†”ì†” ë¶ˆì–´ ì‹œì›í•˜ë‹¤.",
  "ë¹„ê°€ ë‚´ë¦° ë’¤ ë¬´ì§€ê°œê°€ ë–´ë‹¤.",
  "ë”°ëœ»í•œ ì°¨ í•œ ì”ì´ ëª¸ì„ ë…¹ì¸ë‹¤.",
  "ì‘ì€ ìƒˆê°€ ì°½ë°–ì—ì„œ ì§€ì €ê·€ì—ˆë‹¤.",
  "ê¸¸ê°€ì— ë…¸ë€ ë¯¼ë“¤ë ˆê°€ í”¼ì—ˆë‹¤.",
  "ì˜¤ëŠ˜ì€ ìˆ˜ì—…ì´ ì¼ì° ëë‚¬ë‹¤.",
  "ì €ë… í•˜ëŠ˜ì— ë¶‰ì€ ë…¸ì„ì´ ì§€ê³  ìˆë‹¤.",
  "ì„œì ì—ì„œ ìƒˆ ì±…ì„ ê³¨ëë‹¤.",
  "ê°•ì•„ì§€ê°€ ê¼¬ë¦¬ë¥¼ í”ë“¤ë©° ë‹¬ë ¤ì˜¨ë‹¤.",
  "ì ì‹¬ì‹œê°„ì— ë§›ìˆëŠ” ë¶ˆê³ ê¸°ë¥¼ ë¨¹ì—ˆë‹¤.",
  "ê½ƒí–¥ê¸°ê°€ ì§‘ ì•ˆ ê°€ë“ í¼ì¡Œë‹¤.",
  "ìì „ê±°ë¥¼ íƒ€ê³  ê°•ë³€ì„ ë‹¬ë ¸ë‹¤.",
  "í¸ì˜ì ì—ì„œ ì‹œì›í•œ ìŒë£Œë¥¼ ìƒ€ë‹¤.",
  "ë¼ë””ì˜¤ì—ì„œ ì‹ ë‚˜ëŠ” ìŒì•…ì´ í˜ëŸ¬ë‚˜ì™”ë‹¤.",
  "í‰ë²”í•œ í•˜ë£¨ê°€ ì†Œì†Œí•œ í–‰ë³µì„ ì¤€ë‹¤.",
  "ì²œì²œíˆ ê±·ë‹¤ ë³´ë‹ˆ ë§ˆìŒì´ ì•ˆì •ëœë‹¤.",
  "í•™êµ ìš´ë™ì¥ì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¶•êµ¬ë¥¼ í–ˆë‹¤.",
  "ì•„ì¹¨ì— ì¼ì° ì¼ì–´ë‚˜ë‹ˆ ìƒì¾Œí•˜ë‹¤.",
  "ì‹œê³¨ê¸¸ì— ì½”ìŠ¤ëª¨ìŠ¤ê°€ í”ë“¤ë¦¬ê³  ìˆë‹¤.",
  "í‡´ê·¼ í›„ ë”°ëœ»í•œ êµ­ë¬¼ì´ ìƒê°ë‚œë‹¤.",
  "ì§‘ ì• ë‚˜ë¬´ì— ìƒˆì‹¹ì´ ë‹ì•˜ë‹¤.",
  "ì°½ë¬¸ì„ ì—¬ë‹ˆ ìƒì¾Œí•œ ê³µê¸°ê°€ ë“¤ì–´ì˜¨ë‹¤.",
  "ë§›ìˆëŠ” ë¹µ ëƒ„ìƒˆê°€ ê³¨ëª©ì„ ê°€ë“ ì±„ì› ë‹¤.",
  "ê°€ì„ í•˜ëŠ˜ì´ ë†’ê³  í‘¸ë¥´ë‹¤.",
  "ëª¨ë‹¥ë¶ˆì´ í™œí™œ íƒ€ì˜¤ë¥¸ë‹¤.",
  "ë‹¬ë¹›ì´ ì€ì€í•˜ê²Œ ë§ˆë‹¹ì„ ë¹„ì¶˜ë‹¤.",
  "ì¢…ì´ë¹„í–‰ê¸°ê°€ ë©€ë¦¬ ë‚ ì•„ê°”ë‹¤.",
  "ë°°ê°€ ê³ íŒŒì„œ ê³¼ìë¥¼ ì¡°ê¸ˆ ë¨¹ì—ˆë‹¤.",
  "ë„ì„œê´€ì—ì„œ ì¡°ìš©íˆ ì±…ì„ ì½ì—ˆë‹¤.",
  "ì•„ì´ë“¤ì€ ìš´ë™ì¥ì—ì„œ ë›°ì–´ë†€ì•˜ë‹¤.",
  "ì»´í“¨í„°ë¥¼ ì¼œë‹ˆ ì—…ë°ì´íŠ¸ê°€ ì‹œì‘ë˜ì—ˆë‹¤.",
  "ì´ˆì½œë¦¿ì´ ë‹¬ì½¤í•˜ê²Œ ë…¹ì•„ë‚´ë¦°ë‹¤.",
  "ë¹—ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©° ì ì´ ë“¤ì—ˆë‹¤.",
  "ì—°ëª»ì— ë¬¼ê³ ê¸°ê°€ ìœ ìœ íˆ í—¤ì—„ì¹œë‹¤.",
  "ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ì¼ì •ì´ ì—†ë‹¤.",
  "ì‚°ì†ì—ì„œ ì‹œì›í•œ ê³„ê³¡ë¬¼ì´ íë¥¸ë‹¤.",
  "ë§¤ë¯¸ ì†Œë¦¬ê°€ ì—¬ë¦„ì„ ì•Œë¦°ë‹¤.",
  "í¸ì•ˆí•œ ì˜ìì— ì•‰ìœ¼ë‹ˆ ì¡¸ìŒì´ ìŸì•„ì§„ë‹¤.",
  "ì €ë…ë§ˆë‹¤ ê³µì›ì—ì„œ ì¡°ê¹…ì„ í•œë‹¤.",
  "ë²„ìŠ¤ ì •ë¥˜ì¥ì— ì‚¬ëŒë“¤ì´ ëª¨ì—¬ ìˆë‹¤.",
  "í•™êµ ì• ë¶„ì‹ì§‘ì´ ëŠ˜ ë¶ì ê±°ë¦°ë‹¤.",
  "ì¼ì° ì ìë¦¬ì— ë“œë‹ˆ í”¼ë¡œê°€ í’€ë¦°ë‹¤.",
  "ê³ ì¥ ë‚œ ì‹œê³„ë¥¼ ê³ ì¹˜ë ¤ê³  ëšœê»‘ì„ ì—´ì—ˆë‹¤.",
  "ëª¨ì„ì´ ì·¨ì†Œë˜ì–´ ê³„íšì„ ë‹¤ì‹œ ì„¸ì›Œì•¼ í–ˆë‹¤.",
  "ì²˜ìŒ ë“£ëŠ” ë…¸ë˜ì¸ë° ë©œë¡œë””ê°€ ê·€ì— ë§´ëˆë‹¤.",
  "ë°”ìœ ì¼ì • ì†ì—ì„œë„ ì ì‹œ ì—¬ìœ ë¥¼ ì°¾ì•˜ë‹¤.",
  "ìƒê°ì§€ ëª»í•œ ë¬¸ì œê°€ ê°‘ìê¸° ë°œìƒí–ˆë‹¤.",
  "ì–´ë¦´ ì  ì¶”ì–µì´ ë– ì˜¤ë¥´ëŠ” ì¥ì†Œë¥¼ ë°©ë¬¸í–ˆë‹¤.",
  "íšŒì˜ê°€ ì˜ˆìƒë³´ë‹¤ ê¸¸ì–´ì ¸ ì ì‹¬ì„ ë†“ì³¤ë‹¤.",
  "ë‚ ì”¨ê°€ ê°‘ìê¸° ë³€í•´ ìš°ì‚°ì„ ì±™ê¸°ì§€ ëª»í–ˆë‹¤.",
  "ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ í™œë™ì„ ì‹œë„í–ˆë‹¤.",
  "ì•½ì† ì‹œê°„ì„ í—·ê°ˆë ¤ ì•½ê°„ ëŠ¦ì„ ë»”í–ˆë‹¤.",
  "ë‚¯ì„  ë„ì‹œì—ì„œ ê¸¸ì„ ìƒì–´ ì ì‹œ í—¤ë§¸ë‹¤.",
  "ì¤‘ìš”í•œ ìë£Œê°€ ì‚¬ë¼ì ¸ í•œì°¸ì„ ì°¾ì•˜ë‹¤.",
  "ê³ ì¥ ë‚œ ì»´í“¨í„°ë¥¼ ìˆ˜ë¦¬í•˜ëŠë¼ ë°¤ì„ ìƒˆì› ë‹¤.",
  "ìµìˆ™í•˜ì§€ ì•Šì€ ìš”ë¦¬ë²•ìœ¼ë¡œ ì €ë…ì„ ì¤€ë¹„í–ˆë‹¤.",
  "ë°”ë‹¤ë¥¼ ë°”ë¼ë³´ë©° ë³µì¡í•œ ë§ˆìŒì„ ì •ë¦¬í–ˆë‹¤.",
  "ê³„íší–ˆë˜ ì—¬í–‰ì´ ì·¨ì†Œë˜ì–´ ì•„ì‰¬ì›€ì´ ë‚¨ì•˜ë‹¤.",
  "ì‹œë„ëŸ¬ìš´ ê³µì‚¬ ì†Œë¦¬ì— ì§‘ì¤‘ì´ ì˜ ë˜ì§€ ì•Šì•˜ë‹¤.",
  "ì˜ˆì•½í•œ ìˆ™ì†Œê°€ ê°‘ìê¸° ì·¨ì†Œë˜ì–´ ë‹¹í™©í–ˆë‹¤.",
  "ê¸´ ëŒ€ê¸° ì‹œê°„ ëì— ë“œë””ì–´ ì°¨ë¡€ê°€ ëŒì•„ì™”ë‹¤.",
  "ìƒˆë¡œìš´ ì§ì¥ì— ì ì‘í•˜ê¸° ìœ„í•´ ë…¸ë ¥í•˜ê³  ìˆë‹¤.",
  "ê¸°ì–µ ì† ì¹œêµ¬ì—ê²Œì„œ ì˜¤ëœë§Œì— ì—°ë½ì´ ì™”ë‹¤.",
  "ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ë¡œ ì†Œí’ ê³„íšì„ ë³€ê²½í–ˆë‹¤.",
  "ì—°ìŠµí•œ ëŒ€ë¡œ ë°œí‘œê°€ ì˜ ë˜ì–´ ë¿Œë“¯í–ˆë‹¤.",
  "ê¸‰í•˜ê²Œ ì‘ì„±í•œ ë©”ì¼ì— ì˜¤íƒ€ê°€ ìˆì–´ ìˆ˜ì •í–ˆë‹¤.",
  "ë°© ì •ë¦¬ë¥¼ í•˜ë‹¤ ì˜¤ëœ ì‚¬ì§„ì„ ë°œê²¬í–ˆë‹¤.",
  "ì‘ì€ ì‹¤ìˆ˜ë¡œ ì „ì²´ ì‘ì—…ì„ ë‹¤ì‹œ ì‹œì‘í–ˆë‹¤.",
  "ì˜¤ëœë§Œì˜ ì¬íšŒë¼ ì–´ìƒ‰í•¨ì´ ëŠê»´ì¡Œë‹¤.",
  "ë³µì¡í•œ ì§€í•˜ì²  ë…¸ì„ ì´ ì•„ì§ ìµìˆ™í•˜ì§€ ì•Šë‹¤.",
  "ì´ì‚¬ ì¤€ë¹„ë¡œ ì§‘ ì•ˆì´ ì–´ìˆ˜ì„ í•´ì¡Œë‹¤.",
  "ì†ŒìŒ ë•Œë¬¸ì— ì ì„ ì„¤ì³ í•˜ë£¨ ì¢…ì¼ í”¼ê³¤í–ˆë‹¤.",
  "ê´€ì°°ë ¥ì´ ë›°ì–´ë‚˜ì•¼ë§Œ í¬ì°©í•  ìˆ˜ ìˆëŠ” ë¯¸ì„¸í•œ ë³€í™”ì˜€ë‹¤.",
  "ëª¨ìˆœë˜ëŠ” ì£¼ì¥ ì†ì—ì„œ ê· í˜• ì¡íŒ í•´ë‹µì„ ì°¾ê¸°ëŠ” ì‰½ì§€ ì•Šì•˜ë‹¤.",
  "ë‚œí•´í•œ ì² í•™ ì„œì ì„ ì½ëŠë¼ ë¨¸ë¦¬ê°€ ì§€ëˆê±°ë ¸ë‹¤.",
  "ë¶ˆí™•ì‹¤í•œ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ë©° ì‹ ì¤‘í•˜ê²Œ ê²°ì •ì„ ë‚´ë ¸ë‹¤.",
  "ëì—†ì´ ì´ì–´ì§„ ì‚°ê¸¸ì„ ì˜¤ë¥´ë‹¤ ë³´ë‹ˆ ì²´ë ¥ì´ í•œê³„ì— ë‹¤ë‹¤ëë‹¤.",
  "ë³µì¡í•œ ì¸ê°„ê´€ê³„ ì†ì—ì„œ ì¤‘ì‹¬ì„ ì¡ê¸°ê°€ ì–´ë ¤ì› ë‹¤.",
  "ì˜ˆìƒì¹˜ ëª»í•œ ë³€ìˆ˜ë¡œ ê³„íšì´ ì™„ì „íˆ ìˆ˜ì •ë˜ì—ˆë‹¤.",
  "ì¥ê¸°ê°„ ì—°êµ¬í•´ ì˜¨ ì‹¤í—˜ì´ ì‹¤íŒ¨ë¡œ ëŒì•„ê°€ ë§ˆìŒì´ ë¬´ê±°ì› ë‹¤.",
  "ë‹¤ì–‘í•œ ì´í•´ê´€ê³„ê°€ ì–½íŒ ë¬¸ì œë¼ í•´ê²° ë°©ì•ˆì´ ë‚œê°í–ˆë‹¤.",
  "ì„¸ë°€í•œ ì¡°ì •ì´ í•„ìš”í•œ ê¸°ê³„ë¼ ë‹¤ë£¨ê¸°ê°€ ê¹Œë‹¤ë¡œì› ë‹¤.",
  "ì§€ì†ì ì¸ ê²½ì œ ë¶ˆí™©ìœ¼ë¡œ ì‹œì¥ ì „ë§ì´ ë¶ˆíˆ¬ëª…í•´ì¡Œë‹¤.",
  "ê°ì •ì„ ì–µëˆ„ë¥¸ ì±„ ì˜ë¬´ë¥¼ ë‹¤í•˜ëŠ” ê²ƒì´ í˜ë“¤ê²Œ ëŠê»´ì¡Œë‹¤.",
  "ê¸´ì¥ëœ í˜‘ìƒ ìë¦¬ì—ì„œ ì„œë¡œì˜ ì†ë‚´ë¥¼ íŒŒì•…í•˜ê¸° ì–´ë ¤ì› ë‹¤.",
  "ë³µí•©ì ì¸ ì›ì¸ì´ ê²¹ì³ ë¬¸ì œê°€ ë”ìš± ì‹¬í™”ë˜ì—ˆë‹¤.",
  "ì •í™•í•œ ë°ì´í„°ë¥¼ í™•ë³´í•˜ì§€ ëª»í•´ ê²°ë¡ ì„ ë‚´ë¦¬ê¸° ì–´ë ¤ì› ë‹¤.",
  "ë¨¸ë¦¿ì†ì„ ìŠ¤ì¹˜ëŠ” ì—¬ëŸ¬ ìƒê°ì´ ë³µì¡í•˜ê²Œ ì–½í˜€ ì •ë¦¬ê°€ ë˜ì§€ ì•Šì•˜ë‹¤.",
  "ì˜ˆë¯¼í•œ ì£¼ì œë¥¼ ë‹¤ë£¨ë‹¤ ë³´ë‹ˆ ë§ í•œë§ˆë””ê°€ ì¡°ì‹¬ìŠ¤ëŸ¬ì› ë‹¤.",
  "ì‚¬ì†Œí•œ ì‹¤ìˆ˜ê°€ ìŒ“ì—¬ í° ì†ì‹¤ë¡œ ì´ì–´ì§ˆ ë»”í–ˆë‹¤.",
  "í˜‘ë™ì´ ì¤‘ìš”í•œ ìƒí™©ì—ì„œ ì˜ê²¬ ì°¨ì´ê°€ ì»¤ì„œ ë‚œê´€ì— ë¶€ë”ªí˜”ë‹¤.",
  "ì˜ˆìˆ ì  ì˜ê°ì„ ì–»ê¸° ìœ„í•´ ì—¬ëŸ¬ ì‹œë„ë¥¼ ë°˜ë³µí–ˆë‹¤."
    ];
    let score = 0;
    let timeLeft = 60;
    let timer;
    let timerStarted = false;
    let currentSentence = '';
    let lastSentence = '';
    let availableSentences = [];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    // ìì†Œ ë‹¨ìœ„ ê³„ì‚°ì„ ìœ„í•œ í•œê¸€ ë¶„ë¦¬ í•¨ìˆ˜
    function splitHangul(char) {
      const HANGUL_START = 0xac00;
      const HANGUL_END = 0xd7a3;

      const INITIALS = [
        'ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ',
        'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…',
      ];

      const MEDIALS = [
        'ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š',
        'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£',
      ];

      const FINALS = [
        '', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½',
        'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹',
        'ã…Œ', 'ã…', 'ã…',
      ];

      const code = char.charCodeAt(0);
      if (code < HANGUL_START || code > HANGUL_END) return [char];

      const offset = code - HANGUL_START;
      const i = Math.floor(offset / 588);
      const m = Math.floor((offset % 588) / 28);
      const f = offset % 28;
      return [INITIALS[i], MEDIALS[m], FINALS[f]].filter(Boolean);
    }

    function countJaso(str) {
      let count = 0;
      for (const ch of str) {
        count += splitHangul(ch).length;
      }
      return count;
    }

    let totalTypedJaso = 0;
    let totalCorrectJaso = 0;
    let usedBackspace = false;

    function prepareGame() {
      document.getElementById('startArea').style.display = 'none';
      document.getElementById('gameArea').style.display = 'block';
      nextSentence();
    }

    function startTimer() {
      if (timerStarted) return;
      timerStarted = true;
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
        updateCPM();
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function nextSentence() {
      if (availableSentences.length === 0) {
        availableSentences = shuffle(sentences.slice());
      }
      const newSentence = availableSentences.pop();
      lastSentence = newSentence;
      currentSentence = newSentence;
      document.getElementById('inputArea').value = '';
      usedBackspace = false;
      updateHighlight();
      document.getElementById('result').textContent = '';
      updateCPM();
    }

    function handleInput() {
      if (!timerStarted) startTimer();
      if (event.inputType === 'deleteContentBackward') {
        usedBackspace = true;
      }
      updateHighlight();
    }

    function updateHighlight() {
      const input = document.getElementById('inputArea').value;
      let highlighted = '';
      for (let i = 0; i < currentSentence.length; i++) {
        if (i < input.length) {
          highlighted += input[i] === currentSentence[i] ? `<span class='correct'>${currentSentence[i]}</span>` : `<span class='wrong'>${currentSentence[i]}</span>`;
        } else {
          highlighted += `<span class='pending'>${currentSentence[i]}</span>`;
        }
      }
      document.getElementById('highlightedSentence').innerHTML = highlighted;
      updateCPM();
    }

    function updateCPM() {
      const charsTyped = totalTypedJaso + countJaso(document.getElementById('inputArea').value);
      const secondsElapsed = 60 - timeLeft;
      const cpm = secondsElapsed > 0 ? Math.round((charsTyped / secondsElapsed) * 60) : 0;
      document.getElementById('cpm').textContent = `í˜„ì¬ CPM: ${cpm}`;
    }

    function checkInput() {
      const input = document.getElementById('inputArea').value.trim();
      const inputJaso = countJaso(input);
      totalTypedJaso += inputJaso;
      let correctJaso = 0;
      for (let i = 0; i < Math.min(input.length, currentSentence.length); i++) {
        if (input[i] === currentSentence[i]) correctJaso += countJaso(currentSentence[i]);
      }
      totalCorrectJaso += correctJaso;

      const accuracy = inputJaso > 0 ? (correctJaso / inputJaso) * 100 : 0;
      if (input === currentSentence && accuracy === 100 && !usedBackspace) {
        score += 150;
        document.getElementById('result').textContent = 'ğŸŒŸ ì™„ë²½ ì •ë‹µ! +150ì ';
      } else if (input === currentSentence) {
        score += 80;
        document.getElementById('result').textContent = 'âœ… ì •ë‹µ! +80ì ';
      } else {
        document.getElementById('result').textContent = 'âŒ ì˜¤ë‹µ!';
      }
      document.getElementById('score').textContent = `ì ìˆ˜: ${score}`;
      nextSentence();
    }

    function endGame() {
      clearInterval(timer);
      document.getElementById('gameArea').style.display = 'none';
      document.getElementById('endArea').style.display = 'block';
      const accuracy = totalTypedJaso > 0 ? ((totalCorrectJaso / totalTypedJaso) * 100).toFixed(2) : 0;
      document.getElementById('finalScore').textContent = `ìµœì¢… ì ìˆ˜: ${score}ì `;
      document.getElementById('finalStats').textContent = `ì´ íƒ€ìˆ˜: ${totalTypedJaso}íƒ€ | ì •í™•ë„: ${accuracy}%`;
      saveScoreLocal('íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„', score);
    }

    function restartGame() {
      location.reload();
    }

    function goToMain() {
      window.location.href = 'index.html';
    }

    function saveScoreLocal(gameName, score) {
      if (!currentUser) {
        console.warn('ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ, ì ìˆ˜ ì €ì¥ ìƒëµ');
        return;
      }
      const allData = JSON.parse(localStorage.getItem('allGameRankings') || '[]');
      allData.push({ id: currentUser.id, name: currentUser.name, game: gameName, score: score, timestamp: Date.now() });
      localStorage.setItem('allGameRankings', JSON.stringify(allData));
      console.log('ì ìˆ˜ localStorageì— ì €ì¥ ì™„ë£Œ');
    }
  </script>
</body>
</html>
