<!-- typing-speed-test.html: Firebase 연동 버전 -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>디버그 동아리 | 타자 속도 테스트</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #fff; }
    .container { background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px); width: 90%; max-width: 700px; padding: 30px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); text-align: center; }
    input, button { padding: 12px; margin: 10px; font-size: 1em; border-radius: 8px; border: none; }
    input { width: 80%; }
    button { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: #fff; cursor: pointer; }
    button:hover { transform: scale(1.05); }
    .highlight-correct { color: #4caf50; }
    .highlight-wrong { color: #f44336; }
  </style>
</head>
<body>
  <div class="container">
    <h1>⌨️ 타자 속도 테스트</h1>
    <div id="sentence">문장이 여기에 표시됩니다</div>
    <input type="text" id="inputArea" placeholder="여기에 입력하세요">
    <div id="result"></div>
    <button onclick="startGame()">다시 시작</button>
    <button onclick="goBack()">메인으로 돌아가기</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwk8QF3jJMzk30QeJR_kFTq6gQXGmoiG4",
      authDomain: "debug-games-hub.firebaseapp.com",
      projectId: "debug-games-hub",
      storageBucket: "debug-games-hub.firebasestorage.app",
      messagingSenderId: "391096300170",
      appId: "1:391096300170:web:156898c1574c15fca9f373"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sentences = [
      "오늘은 맑고 화창한 날씨입니다.",
      "나는 아침에 따뜻한 커피를 마셨습니다.",
      "학교에서 친구들과 재미있게 놀았습니다.",
      "지구의 자전과 공전은 계절의 변화와 낮밤을 만들어 냅니다.",
      "인공지능 기술은 점점 더 우리의 삶에 깊숙이 스며들고 있습니다."
    ];

    let target = '', startTime = 0;
    const sentenceDiv = document.getElementById('sentence');
    const inputEl = document.getElementById('inputArea');
    const resultDiv = document.getElementById('result');

    function startGame() {
      target = sentences[Math.floor(Math.random() * sentences.length)];
      sentenceDiv.textContent = target;
      inputEl.value = '';
      resultDiv.textContent = '';
      startTime = 0;
    }

    inputEl.addEventListener('input', () => {
      if (startTime === 0) startTime = new Date().getTime();
      const userInput = inputEl.value;
      if (userInput === target) {
        const endTime = new Date().getTime();
        const timeTaken = (endTime - startTime) / 1000;
        const cpm = Math.round((target.length / timeTaken) * 60);
        resultDiv.innerHTML = `완료! 시간: ${timeTaken.toFixed(2)}초, CPM: ${cpm}`;
        saveScore(cpm);
      }
    });

    function saveScore(score) {
      const user = JSON.parse(localStorage.getItem('currentUser'));
      if (!user) return;
      const newEntry = {
        id: user.id,
        name: user.name,
        game: '타자 속도 테스트',
        score: score,
        time: new Date().toISOString()
      };
      const newKey = db.ref().child('rankings').push().key;
      const updates = {};
      updates['/rankings/' + newKey] = newEntry;
      db.ref().update(updates);
      alert(`최종 점수(CPM): ${score}`);
    }

    function goBack() {
      window.location.href = '/-Debug-Games-Hub/index.html';
    }

    window.onload = startGame;
  </script>
</body>
</html>
