<!-- typing-speed-test.html: íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„ (ì—°ì† ë¬¸ì¥ ë°©ì§€, ì…ë ¥ ì‹œ íƒ€ì´ë¨¸ ì‹œì‘, íƒ€ìˆ˜ ë° ì •í™•ë„ í‘œì‹œ, ë³´ë„ˆìŠ¤ ì ìˆ˜ ì¶”ê°€) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„</title>
  <style>
    body { font-family: sans-serif; background: linear-gradient(135deg, #373b44, #4286f4); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .container { background: rgba(0,0,0,0.6); padding: 30px; border-radius: 16px; width: 90%; max-width: 700px; text-align: center; }
    h1 { margin-bottom: 20px; }
    input, button { padding: 10px; margin: 10px 0; border: none; border-radius: 8px; width: 100%; font-size: 1em; }
    input { color: #333; }
    button { background: #4caf50; color: #fff; cursor: pointer; }
    button:hover { background: #43a047; }
    #result, #cpm { font-size: 1.2em; margin-top: 10px; }
    #highlightedSentence span.correct { color: #4caf50; }
    #highlightedSentence span.wrong { color: #f44336; }
    #highlightedSentence span.pending { color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <div id="startArea">
      <h1>âŒ¨ï¸ íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„</h1>
      <p>ê²Œì„ ì„¤ëª…: ì£¼ì–´ì§„ ë¬¸ì¥ì„ ìµœëŒ€í•œ ë¹¨ë¦¬ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”. 60ì´ˆ ì œí•œ ì‹œê°„ ì•ˆì— ìµœëŒ€ ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”!</p>
      <button onclick="prepareGame()">ê²Œì„ ì‹œì‘</button>
      <button onclick="goToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="gameArea" style="display:none;">
      <p id="highlightedSentence"></p>
      <input type="text" id="inputArea" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”" oninput="handleInput()" onkeydown="if(event.key==='Enter') checkInput()">
      <button onclick="checkInput()">ì œì¶œ</button>
      <p id="score">ì ìˆ˜: 0</p>
      <p id="cpm">í˜„ì¬ CPM: 0</p>
      <p id="timer">ë‚¨ì€ ì‹œê°„: 60ì´ˆ</p>
      <p id="result"></p>
    </div>

    <div id="endArea" style="display:none;">
      <h2>ğŸ‰ ê²Œì„ ì¢…ë£Œ</h2>
      <p id="finalScore"></p>
      <p id="finalStats"></p>
      <button onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
      <button onclick="goToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </div>

  <script>
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const sentences = [
      "ì˜¤ëŠ˜ì€ ë§‘ê³  í™”ì°½í•œ ë‚ ì”¨ì…ë‹ˆë‹¤.",
      "ë‚˜ëŠ” ë§¤ì¼ ì•„ì¹¨ ì‚°ì±…ì„ í•©ë‹ˆë‹¤.",
      "ì •ë³´ ë³´ì•ˆì€ í•„ìˆ˜ì ì¸ ìš”ì†Œì…ë‹ˆë‹¤.",
      "ì½”ë”©ì€ ì°½ì˜ì„±ê³¼ ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤."
    ];
    let score = 0;
    let timeLeft = 60;
    let timer;
    let timerStarted = false;
    let currentSentence = '';
    let lastSentence = '';
    let totalTypedChars = 0;
    let totalCorrectChars = 0;
    let usedBackspace = false;

    function prepareGame() {
      document.getElementById('startArea').style.display = 'none';
      document.getElementById('gameArea').style.display = 'block';
      nextSentence();
    }

    function startTimer() {
      if (timerStarted) return;
      timerStarted = true;
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function nextSentence() {
      let newSentence;
      do {
        newSentence = sentences[Math.floor(Math.random() * sentences.length)];
      } while (newSentence === lastSentence);
      lastSentence = newSentence;
      currentSentence = newSentence;
      document.getElementById('inputArea').value = '';
      usedBackspace = false;
      updateHighlight();
      document.getElementById('result').textContent = '';
      updateCPM();
    }

    function handleInput() {
      if (!timerStarted) startTimer();
      if (event.inputType === 'deleteContentBackward') {
        usedBackspace = true;
      }
      updateHighlight();
    }

    function updateHighlight() {
      const input = document.getElementById('inputArea').value;
      let highlighted = '';
      for (let i = 0; i < currentSentence.length; i++) {
        if (i < input.length) {
          highlighted += input[i] === currentSentence[i] ? `<span class='correct'>${currentSentence[i]}</span>` : `<span class='wrong'>${currentSentence[i]}</span>`;
        } else {
          highlighted += `<span class='pending'>${currentSentence[i]}</span>`;
        }
      }
      document.getElementById('highlightedSentence').innerHTML = highlighted;
      updateCPM();
    }

    function updateCPM() {
      const charsTyped = totalTypedChars + document.getElementById('inputArea').value.length;
      const secondsElapsed = 60 - timeLeft;
      const cpm = secondsElapsed > 0 ? Math.round((charsTyped / secondsElapsed) * 60) : 0;
      document.getElementById('cpm').textContent = `í˜„ì¬ CPM: ${cpm}`;
    }

    function checkInput() {
      const input = document.getElementById('inputArea').value.trim();
      totalTypedChars += input.length;
      let correctCount = 0;
      for (let i = 0; i < Math.min(input.length, currentSentence.length); i++) {
        if (input[i] === currentSentence[i]) correctCount++;
      }
      totalCorrectChars += correctCount;

      const accuracy = input.length > 0 ? (correctCount / input.length) * 100 : 0;
      if (input === currentSentence && accuracy === 100 && !usedBackspace) {
        score += 150;
        document.getElementById('result').textContent = 'ğŸŒŸ ì™„ë²½ ì •ë‹µ! +150ì ';
      } else if (input === currentSentence) {
        score += 80;
        document.getElementById('result').textContent = 'âœ… ì •ë‹µ! +80ì ';
      } else {
        document.getElementById('result').textContent = 'âŒ ì˜¤ë‹µ!';
      }
      document.getElementById('score').textContent = `ì ìˆ˜: ${score}`;
      nextSentence();
    }

    function endGame() {
      clearInterval(timer);
      document.getElementById('gameArea').style.display = 'none';
      document.getElementById('endArea').style.display = 'block';
      const accuracy = totalTypedChars > 0 ? ((totalCorrectChars / totalTypedChars) * 100).toFixed(2) : 0;
      document.getElementById('finalScore').textContent = `ìµœì¢… ì ìˆ˜: ${score}ì `;
      document.getElementById('finalStats').textContent = `ì´ íƒ€ìˆ˜: ${totalTypedChars}íƒ€ | ì •í™•ë„: ${accuracy}%`;
      saveScoreLocal('íƒ€ì ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„', score);
    }

    function restartGame() {
      location.reload();
    }

    function goToMain() {
      window.location.href = 'index.html';
    }

    function saveScoreLocal(gameName, score) {
      if (!currentUser) {
        console.warn('ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ, ì ìˆ˜ ì €ì¥ ìƒëµ');
        return;
      }
      const allData = JSON.parse(localStorage.getItem('allGameRankings') || '[]');
      allData.push({ id: currentUser.id, name: currentUser.name, game: gameName, score: score, timestamp: Date.now() });
      localStorage.setItem('allGameRankings', JSON.stringify(allData));
      console.log('ì ìˆ˜ localStorageì— ì €ì¥ ì™„ë£Œ');
    }
  </script>
</body>
</html>
