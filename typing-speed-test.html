<!-- typing-speed-test.html: 타자 속도 테스트 게임 (localStorage 기반 점수 저장) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>타자 속도 테스트 게임</title>
  <style>
    body { font-family: sans-serif; background: linear-gradient(135deg, #373b44, #4286f4); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .container { background: rgba(0,0,0,0.6); padding: 30px; border-radius: 16px; width: 90%; max-width: 600px; text-align: center; }
    h1 { margin-bottom: 20px; }
    input, button { padding: 10px; margin: 10px 0; border: none; border-radius: 8px; width: 100%; font-size: 1em; }
    input { color: #333; }
    button { background: #4caf50; color: #fff; cursor: pointer; }
    button:hover { background: #43a047; }
    #result { font-size: 1.2em; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>⌨️ 타자 속도 테스트 게임</h1>
    <p id="sentence">문장이 여기에 표시됩니다.</p>
    <input type="text" id="inputArea" placeholder="여기에 입력하세요">
    <button onclick="checkInput()">제출</button>
    <p id="score">점수: 0</p>
    <p id="timer">남은 시간: 60초</p>
    <p id="result"></p>
    <div id="endArea" style="display:none;">
      <h2>🎉 게임 종료</h2>
      <p id="finalScore"></p>
      <button onclick="restartGame()">다시 시작</button>
      <button onclick="goToMain()">메인으로 돌아가기</button>
    </div>
  </div>

  <script>
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const sentences = [
      "오늘은 맑고 화창한 날씨입니다.",
      "나는 매일 아침 산책을 합니다.",
      "정보 보안은 필수적인 요소입니다.",
      "코딩은 창의성과 논리적 사고를 요구합니다."
    ];
    let score = 0;
    let timeLeft = 60;
    let timer;

    function startGame() {
      nextSentence();
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `남은 시간: ${timeLeft}초`;
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function nextSentence() {
      const randomIndex = Math.floor(Math.random() * sentences.length);
      document.getElementById('sentence').textContent = sentences[randomIndex];
      document.getElementById('inputArea').value = '';
      document.getElementById('result').textContent = '';
    }

    function checkInput() {
      const input = document.getElementById('inputArea').value.trim();
      const target = document.getElementById('sentence').textContent;
      if (input === target) {
        score += 100;
        document.getElementById('result').textContent = '✅ 정답!';
      } else {
        document.getElementById('result').textContent = '❌ 오답!';
      }
      document.getElementById('score').textContent = `점수: ${score}`;
      nextSentence();
    }

    function endGame() {
      clearInterval(timer);
      document.querySelector('.container').innerHTML = `<h2>🎉 게임 종료</h2><p>최종 점수: ${score}점</p><button onclick='restartGame()'>다시 시작</button><button onclick='goToMain()'>메인으로 돌아가기</button>`;
      saveScoreLocal('타자 속도 테스트 게임', score);
    }

    function restartGame() {
      location.reload();
    }

    function goToMain() {
      window.location.href = 'index.html';
    }

    function saveScoreLocal(gameName, score) {
      if (!currentUser) {
        console.warn('로그인 정보 없음, 점수 저장 생략');
        return;
      }
      const allData = JSON.parse(localStorage.getItem('allGameRankings') || '[]');
      allData.push({ id: currentUser.id, name: currentUser.name, game: gameName, score: score, timestamp: Date.now() });
      localStorage.setItem('allGameRankings', JSON.stringify(allData));
      console.log('점수 localStorage에 저장 완료');
    }

    window.onload = startGame;
  </script>
</body>
</html>
